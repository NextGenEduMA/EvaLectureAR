<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Reading Assessment - Test Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            padding: 10px;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .arabic-text {
            font-family: 'Arial Unicode MS', 'Tahoma', sans-serif;
            font-size: 18px;
            direction: rtl;
            text-align: right;
            line-height: 1.6;
        }
        .score-display {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        .score-item {
            text-align: center;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Arabic Reading Assessment Platform - Test Interface</h1>
        <p>Test the AI-powered Arabic reading assessment system with speech recognition, pronunciation analysis, and personalized feedback.</p>
    </div>

    <!-- Quick Setup -->
    <div class="container section">
        <h3>üöÄ Quick Setup</h3>
        <button onclick="createTestData()">Create Test Data (Student & Text)</button>
        <div id="setupResult" class="result" style="display: none;"></div>
    </div>

    <!-- Student Management -->
    <div class="container section">
        <h3>üë§ Student Management</h3>
        <div class="form-group">
            <label>Student Name:</label>
            <input type="text" id="studentName" placeholder="Enter student name">
        </div>
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="studentEmail" placeholder="Enter email">
        </div>
        <div class="form-group">
            <label>Level:</label>
            <select id="studentLevel">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select>
        </div>
        <button onclick="createStudent()">Create Student</button>
        <div id="studentResult" class="result" style="display: none;"></div>
    </div>

    <!-- Text Management -->
    <div class="container section">
        <h3>üìù Text Management</h3>
        <div class="form-group">
            <label>Title:</label>
            <input type="text" id="textTitle" placeholder="Enter text title">
        </div>
        <div class="form-group">
            <label>Arabic Content:</label>
            <textarea id="textContent" rows="4" class="arabic-text" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜÿµ ÿßŸÑÿπÿ±ÿ®Ÿä ŸáŸÜÿß"></textarea>
        </div>
        <div class="form-group">
            <label>Content with Diacritics (ÿ™ÿ¥ŸÉŸäŸÑ):</label>
            <textarea id="textDiacritics" rows="4" class="arabic-text" placeholder="ÿ£ŸéÿØŸíÿÆŸêŸÑŸê ÿßŸÑŸÜŸéŸëÿµŸéŸë ÿßŸÑÿπŸéÿ±Ÿéÿ®ŸêŸäŸéŸë ŸÖŸéÿπŸé ÿßŸÑÿ™ŸéŸëÿ¥ŸíŸÉŸêŸäŸÑŸê ŸáŸèŸÜÿß"></textarea>
        </div>
        <div class="form-group">
            <label>Difficulty:</label>
            <select id="textDifficulty">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select>
        </div>
        <div class="form-group">
            <label>Category:</label>
            <input type="text" id="textCategory" placeholder="e.g., religious, literature, news">
        </div>
        <button onclick="createText()">Create Text</button>
        <button onclick="loadTexts()">Load Available Texts</button>
        <div id="textResult" class="result" style="display: none;"></div>
    </div>

    <!-- Audio Assessment -->
    <div class="container section">
        <h3>üéôÔ∏è Audio Assessment</h3>
        <div class="form-group">
            <label>Student ID:</label>
            <input type="number" id="assessmentStudentId" placeholder="Enter student ID">
        </div>
        <div class="form-group">
            <label>Text ID:</label>
            <input type="number" id="assessmentTextId" placeholder="Enter text ID">
        </div>
        <div class="form-group">
            <label>Audio File:</label>
            <input type="file" id="audioFile" accept=".wav,.mp3,.m4a,.ogg,.flac">
        </div>
        <button onclick="uploadAssessment()">Upload & Assess</button>
        <div id="assessmentResult" class="result" style="display: none;"></div>
    </div>

    <!-- Assessment Results -->
    <div class="container section">
        <h3>üìä Assessment Results</h3>
        <div class="form-group">
            <label>Assessment ID:</label>
            <input type="number" id="resultAssessmentId" placeholder="Enter assessment ID">
        </div>
        <button onclick="getAssessmentResult()">Get Results</button>
        <div id="resultDisplay" class="result" style="display: none;"></div>
    </div>

    <!-- Student Progress -->
    <div class="container section">
        <h3>üìà Student Progress</h3>
        <div class="form-group">
            <label>Student ID:</label>
            <input type="number" id="progressStudentId" placeholder="Enter student ID">
        </div>
        <div class="form-group">
            <label>Days to analyze:</label>
            <input type="number" id="progressDays" value="30" placeholder="30">
        </div>
        <button onclick="getStudentProgress()">Get Progress Report</button>
        <button onclick="getRecommendations()">Get Recommendations</button>
        <div id="progressResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        async function apiCall(endpoint, method = 'GET', data = null, isFormData = false) {
            try {
                const options = {
                    method: method,
                    headers: {}
                };

                if (data) {
                    if (isFormData) {
                        options.body = data;
                    } else {
                        options.headers['Content-Type'] = 'application/json';
                        options.body = JSON.stringify(data);
                    }
                }

                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                return { status: response.status, data: result };
            } catch (error) {
                return { status: 500, data: { success: false, message: error.message } };
            }
        }

        function displayResult(elementId, result, isSuccess = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(result, null, 2);
            
            if (isSuccess !== null) {
                element.className = `result ${isSuccess ? 'success' : 'error'}`;
            }
        }

        async function createTestData() {
            const result = await apiCall('/demo/quick-test', 'POST');
            displayResult('setupResult', result.data, result.data.success);
            
            if (result.data.success) {
                document.getElementById('assessmentStudentId').value = result.data.student_id;
                document.getElementById('assessmentTextId').value = result.data.text_id;
                document.getElementById('progressStudentId').value = result.data.student_id;
            }
        }

        async function createStudent() {
            const data = {
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                level: document.getElementById('studentLevel').value
            };

            if (!data.name || !data.email) {
                alert('Please fill in name and email');
                return;
            }

            const result = await apiCall('/students', 'POST', data);
            displayResult('studentResult', result.data, result.data.success);
        }

        async function createText() {
            const data = {
                title: document.getElementById('textTitle').value,
                content: document.getElementById('textContent').value,
                content_with_diacritics: document.getElementById('textDiacritics').value,
                difficulty_level: document.getElementById('textDifficulty').value,
                category: document.getElementById('textCategory').value
            };

            if (!data.title || !data.content) {
                alert('Please fill in title and content');
                return;
            }

            const result = await apiCall('/texts', 'POST', data);
            displayResult('textResult', result.data, result.data.success);
        }

        async function loadTexts() {
            const result = await apiCall('/texts');
            displayResult('textResult', result.data, result.data.success);
        }

        async function uploadAssessment() {
            const studentId = document.getElementById('assessmentStudentId').value;
            const textId = document.getElementById('assessmentTextId').value;
            const audioFile = document.getElementById('audioFile').files[0];

            if (!studentId || !textId || !audioFile) {
                alert('Please fill in all fields and select an audio file');
                return;
            }

            const formData = new FormData();
            formData.append('student_id', studentId);
            formData.append('text_id', textId);
            formData.append('audio', audioFile);

            const result = await apiCall('/assessments', 'POST', formData, true);
            displayResult('assessmentResult', result.data, result.data.success);
            
            if (result.data.success && result.data.assessment_id) {
                document.getElementById('resultAssessmentId').value = result.data.assessment_id;
            }
        }

        async function getAssessmentResult() {
            const assessmentId = document.getElementById('resultAssessmentId').value;
            
            if (!assessmentId) {
                alert('Please enter assessment ID');
                return;
            }

            const result = await apiCall(`/assessments/${assessmentId}`);
            
            if (result.data.success && result.data.assessment) {
                const assessment = result.data.assessment;
                let display = `Assessment Results:\n\n`;
                display += `Status: ${assessment.status}\n`;
                display += `Student: ${assessment.student?.name} (Level: ${assessment.student?.level})\n`;
                display += `Text: ${assessment.text?.title}\n\n`;
                
                if (assessment.scores) {
                    display += `SCORES:\n`;
                    display += `Overall: ${assessment.scores.overall}/100\n`;
                    display += `Pronunciation: ${assessment.scores.pronunciation}/100\n`;
                    display += `Fluency: ${assessment.scores.fluency}/100\n`;
                    display += `Accuracy: ${assessment.scores.accuracy}/100\n`;
                    display += `Comprehension: ${assessment.scores.comprehension}/100\n\n`;
                }
                
                if (assessment.transcription) {
                    display += `TRANSCRIPTION:\n${assessment.transcription.text}\n`;
                    display += `Confidence: ${assessment.transcription.confidence}\n\n`;
                }
                
                if (assessment.feedback) {
                    display += `FEEDBACK:\n${assessment.feedback}\n\n`;
                }
                
                if (assessment.recommendations && assessment.recommendations.length > 0) {
                    display += `RECOMMENDATIONS:\n`;
                    assessment.recommendations.forEach((rec, i) => {
                        display += `${i + 1}. ${rec}\n`;
                    });
                }
                
                document.getElementById('resultDisplay').textContent = display;
            } else {
                displayResult('resultDisplay', result.data, false);
            }
            
            document.getElementById('resultDisplay').style.display = 'block';
        }

        async function getStudentProgress() {
            const studentId = document.getElementById('progressStudentId').value;
            const days = document.getElementById('progressDays').value || 30;
            
            if (!studentId) {
                alert('Please enter student ID');
                return;
            }

            const result = await apiCall(`/students/${studentId}/progress?days=${days}`);
            displayResult('progressResult', result.data, result.data.success);
        }

        async function getRecommendations() {
            const studentId = document.getElementById('progressStudentId').value;
            
            if (!studentId) {
                alert('Please enter student ID');
                return;
            }

            const result = await apiCall(`/students/${studentId}/recommendations`);
            displayResult('progressResult', result.data, result.data.success);
        }

        // Auto-load test data on page load
        window.onload = function() {
            console.log('Arabic Reading Assessment Platform - Test Interface Loaded');
            console.log('Click "Create Test Data" to get started quickly!');
        };
    </script>
</body>
</html>
